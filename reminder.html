<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>‚è∞ Reminder Dashboard ‚Äì LocalStorage + Backup</title>
    <style>
        :root {
            --bg: #0b1220;
            --card: #101827;
            --muted: #93a3b8;
            --text: #e5e7eb;
            --stroke: #1f2937;
            --accent: #22d3ee;
            --accent2: #8b5cf6;
            --warn: #f59e0b;
            --bad: #ef4444;
            --good: #10b981
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: system-ui, Segoe UI, Inter, Arial, sans-serif;
            background: linear-gradient(135deg, #0b1220, #0b1220 60%, #111827);
            color: var(--text)
        }

        .wrap {
            max-width: 1024px;
            margin-inline: auto;
            padding: 20px
        }

        h1 {
            margin: 6px 0 10px;
            font-size: 26px;
            font-weight: 800
        }

        .muted {
            color: var(--muted)
        }

        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap
        }

        .card {
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .25)
        }

        input,
        select,
        textarea,
        button {
            font: inherit
        }

        input,
        select,
        textarea {
            width: 100%;
            background: #0f172a;
            border: 1px solid var(--stroke);
            color: var(--text);
            border-radius: 12px;
            padding: 10px;
            outline: none
        }

        textarea {
            min-height: 72px
        }

        input:focus,
        select:focus,
        textarea:focus {
            box-shadow: 0 0 0 3px rgba(34, 211, 238, .15)
        }

        .btn {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: 0;
            color: #fff;
            padding: 10px 14px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer
        }

        .btn.ghost {
            background: #0f172a;
            border: 1px solid var(--stroke)
        }

        .grid {
            display: grid;
            grid-template-columns: 1.2fr .8fr;
            gap: 16px
        }

        @media (max-width:900px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .pill {
            display: inline-block;
            padding: 2px 8px;
            border: 1px solid var(--stroke);
            border-radius: 999px;
            color: var(--muted);
            font-size: 12px
        }

        .list {
            display: grid;
            gap: 12px
        }

        .item {
            background: #0f172a;
            border: 1px solid var(--stroke);
            border-radius: 14px;
            padding: 12px
        }

        .meta {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            color: var(--muted);
            font-size: 12px;
            margin-bottom: 8px
        }

        .title {
            font-weight: 800;
            font-size: 16px
        }

        .bad {
            color: var(--bad)
        }

        .warn {
            color: var(--warn)
        }

        .good {
            color: var(--good)
        }

        .countdown {
            font-weight: 700
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center
        }

        .kpis {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px
        }

        .k {
            background: #0f172a;
            border: 1px solid var(--stroke);
            border-radius: 12px;
            padding: 10px;
            text-align: center
        }

        .k h3 {
            margin: 0;
            color: var(--muted);
            font-size: 12px
        }

        .k .v {
            font-size: 22px;
            font-weight: 800
        }

        .reminder {
            margin-top: 8px;
            color: #facc15;
            font-weight: 600
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1>‚è∞ Reminder Dashboard <span class="muted">(LocalStorage + Backup/Upload)</span></h1>
        <p>
            Th√™m nh·∫Øc nh·ªü theo danh m·ª•c (m·∫∑c ƒë·ªãnh c√≥ ‚ÄúƒêƒÉng k√Ω d·ªãch v·ª•‚Äù, ‚ÄúTi·ªÅn n∆∞·ªõc‚Äù, b·∫°n c√≥ th·ªÉ t·ª± th√™m danh m·ª•c kh√°c).

            Ch·ªçn h·∫°n (ng√†y & gi·ªù), ghi ghi ch√∫, xem ƒë·∫øm ng∆∞·ª£c th·ªùi gian c√≤n l·∫°i (c·∫£nh b√°o khi <24h, v√† b√°o qu√° h·∫°n). T√¨m
                ki·∫øm, l·ªçc theo danh m·ª•c. Export JSON (backup) v√† Import JSON (upload) ƒë·ªÉ sao l∆∞u/kh√¥i ph·ª•c d·ªØ li·ªáu. Ch·ªâ
                s·ªë t·ªïng quan: s·ªë vi·ªác ƒëang m·ªü, s·∫Øp ƒë·∫øn h·∫°n 24h, qu√° h·∫°n. Nh·∫Øc b·∫°n backup m·ªói 7 ng√†y. </p>
                <div class="grid">
                    <!-- LEFT: CREATE / EDIT -->
                    <section class="card">
                        <h2 style="margin:0 0 8px">Th√™m nh·∫Øc nh·ªü m·ªõi</h2>
                        <div class="row">
                            <div style="flex:1;min-width:220px">
                                <label class="muted">Ti√™u ƒë·ªÅ</label>
                                <input id="title" placeholder="V√≠ d·ª•: ƒêƒÉng k√Ω g√≥i c∆∞·ªõc, ƒê√≥ng ti·ªÅn n∆∞·ªõc">
                            </div>
                            <div style="width:200px">
                                <label class="muted">Danh m·ª•c</label>
                                <select id="category"></select>
                            </div>
                        </div>
                        <div class="row" style="margin-top:8px">
                            <div style="width:220px">
                                <label class="muted">H·∫°n (ng√†y & gi·ªù)</label>
                                <input id="due" type="datetime-local">
                            </div>
                            <div style="flex:1;min-width:180px">
                                <label class="muted">Ghi ch√∫</label>
                                <input id="note" placeholder="Ghi ch√∫ ng·∫Øn...">
                            </div>
                        </div>
                        <div class="row" style="margin-top:8px">
                            <button class="btn" id="saveBtn">L∆∞u</button>
                            <button class="btn ghost" id="clearForm">X√≥a form</button>
                            <span id="msg" class="muted"></span>
                        </div>

                        <h3 style="margin:16px 0 8px">Danh m·ª•c tu·ª≥ ch·ªânh</h3>
                        <div class="row">
                            <div style="flex:1;min-width:220px"><input id="newCat"
                                    placeholder="VD: H√≥a ƒë∆°n, Gia ƒë√¨nh, C√¥ng vi·ªác"></div>
                            <button class="btn ghost" id="addCatBtn">+ Th√™m danh m·ª•c</button>
                        </div>
                        <p class="muted" style="margin-top:6px">M·∫∑c ƒë·ªãnh c√≥ s·∫µn: <span class="pill">ƒêƒÉng k√Ω d·ªãch
                                v·ª•</span> <span class="pill">Ti·ªÅn n∆∞·ªõc</span> <span class="pill">Kh√°c</span>. B·∫°n c√≥ th·ªÉ
                            th√™m danh m·ª•c ri√™ng.
                        </p>
                    </section>

                    <!-- RIGHT: TOOLS / KPIs -->
                    <aside class="card">
                        <h2 style="margin:0 0 8px">C√¥ng c·ª• & Sao l∆∞u</h2>
                        <div class="kpis">
                            <div class="k">
                                <h3>ƒêang m·ªü</h3>
                                <div class="v" id="kOpen">0</div>
                            </div>
                            <div class="k">
                                <h3>S·∫Øp ƒë·∫øn h·∫°n (24h)</h3>
                                <div class="v" id="kSoon">0</div>
                            </div>
                            <div class="k">
                                <h3>Qu√° h·∫°n</h3>
                                <div class="v bad" id="kOver">0</div>
                            </div>
                        </div>
                        <div class="toolbar" style="margin-top:10px">
                            <button class="btn" id="exportBtn">üíæ Export JSON</button>
                            <button class="btn ghost" id="importBtn">üì• Import JSON</button>
                            <input id="importFile" type="file" accept="application/json" style="display:none" />
                        </div>
                        <div class="toolbar" style="margin-top:10px">
                            <input id="search" placeholder="T√¨m theo ti√™u ƒë·ªÅ/ghi ch√∫..." style="flex:1;min-width:180px">
                            <select id="filterCat" style="width:200px"></select>
                        </div>
                        <div id="backupReminder" class="reminder"></div>
                    </aside>
                </div>

                <section class="card" style="margin-top:16px">
                    <h2 style="margin:0 0 8px">Danh s√°ch nh·∫Øc nh·ªü</h2>
                    <div id="items" class="list" aria-live="polite"></div>
                </section>
    </div>

    <script>
        const KEY_ITEMS = 'reminder_items_v1';
        const KEY_CATS = 'reminder_categories_v1';
        const KEY_BACKUP = 'reminder_last_backup';

        let items = load(KEY_ITEMS, []);
        let categories = load(KEY_CATS, ['ƒêƒÉng k√Ω d·ªãch v·ª•', 'Ti·ªÅn n∆∞·ªõc', 'Kh√°c']);

        // ===== Helpers =====
        function $(id) { return document.getElementById(id) }
        function load(key, def) { try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : def } catch { return def } }
        function save(key, val) { localStorage.setItem(key, JSON.stringify(val)) }
        function uid() { return Date.now() + "_" + Math.random().toString(36).slice(2, 7) }
        function fmtDate(dt) { const d = new Date(dt); return d.toLocaleString() }
        function byId(id) { return document.querySelector(`[data-id="${id}"]`) }

        function msLeft(due) { return new Date(due).getTime() - Date.now() }
        function humanLeft(ms) {
            const neg = ms < 0; const a = Math.abs(ms);
            const d = Math.floor(a / 86400000); const h = Math.floor((a % 86400000) / 3600000); const m = Math.floor((a % 3600000) / 60000);
            const s = `${d}d ${h}h ${m}m`;
            return neg ? `Qu√° ${s}` : `C√≤n ${s}`;
        }

        function updateBackupReminder() {
            const last = Number(localStorage.getItem(KEY_BACKUP) || 0);
            if (!last) { $('backupReminder').textContent = 'Ch∆∞a t·ª´ng backup! H√£y Export JSON ƒë·ªÉ sao l∆∞u.'; return }
            const diff = Date.now() - last; const days = Math.floor(diff / 86400000); const left = 7 - days;
            $('backupReminder').textContent = left <= 0 ? '‚ö†Ô∏è ƒê√£ qu√° 7 ng√†y ch∆∞a backup. H√£y Export JSON.' : `${left} ng√†y n·ªØa ƒë·∫øn k·ª≥ backup.`
        }

        // ===== UI Init =====
        function fillCategoryOptions() {
            const sel = $('category'); sel.innerHTML = '';
            for (const c of categories) { const o = document.createElement('option'); o.value = c; o.textContent = c; sel.appendChild(o); }
            const fc = $('filterCat'); fc.innerHTML = '';
            const oAll = document.createElement('option'); oAll.value = ''; oAll.textContent = 'T·∫•t c·∫£ danh m·ª•c'; fc.appendChild(oAll);
            for (const c of categories) { const o = document.createElement('option'); o.value = c; o.textContent = c; fc.appendChild(o); }
        }
        fillCategoryOptions();

        // Prefill default quick items (optional)
        if (items.length === 0) {
            const now = new Date();
            const in3d = new Date(now.getTime() + 3 * 86400000); // +3 ng√†y
            const in5d = new Date(now.getTime() + 5 * 86400000); // +5 ng√†y
            items.push({ id: uid(), title: 'ƒêƒÉng k√Ω g√≥i c∆∞·ªõc 4G', category: 'ƒêƒÉng k√Ω d·ªãch v·ª•', due: in3d.toISOString(), note: 'Gia h·∫°n 1 th√°ng', done: false, createdAt: new Date().toISOString() });
            items.push({ id: uid(), title: 'ƒê√≥ng ti·ªÅn n∆∞·ªõc', category: 'Ti·ªÅn n∆∞·ªõc', due: in5d.toISOString(), note: 'PN th√°ng n√†y', done: false, createdAt: new Date().toISOString() });
            save(KEY_ITEMS, items);
        }

        $('due').value = new Date(Date.now() + 3600000).toISOString().slice(0, 16); // +1h

        // ===== CRUD =====
        $('saveBtn').onclick = () => {
            const title = $('title').value.trim();
            const category = $('category').value;
            const due = $('due').value;
            const note = $('note').value.trim();
            if (!title || !due) { $('msg').textContent = 'Vui l√≤ng nh·∫≠p Ti√™u ƒë·ªÅ v√† H·∫°n.'; setTimeout(() => $('msg').textContent = '', 1500); return }
            const obj = { id: uid(), title, category, due: new Date(due).toISOString(), note, done: false, createdAt: new Date().toISOString() };
            items.unshift(obj); save(KEY_ITEMS, items); render(); clearForm();
        }
        $('clearForm').onclick = clearForm;
        function clearForm() { $('title').value = ''; $('note').value = ''; $('due').value = ''; $('title').focus(); }

        $('addCatBtn').onclick = () => {
            const v = $('newCat').value.trim(); if (!v) return; if (!categories.includes(v)) { categories.push(v); save(KEY_CATS, categories); fillCategoryOptions(); $('newCat').value = ''; }
        }

        function delItem(id) { items = items.filter(x => x.id !== id); save(KEY_ITEMS, items); render(); }
        function toggleDone(id) { const it = items.find(x => x.id === id); if (!it) return; it.done = !it.done; save(KEY_ITEMS, items); render(); }

        // ===== Export / Import =====
        $('exportBtn').onclick = () => {
            const payload = { items, categories, exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob); const a = document.createElement('a');
            a.href = url; a.download = 'reminders-backup.json'; a.click(); URL.revokeObjectURL(url);
            localStorage.setItem(KEY_BACKUP, Date.now()); updateBackupReminder();
        }
        $('importBtn').onclick = () => $('importFile').click();
        $('importFile').addEventListener('change', async (e) => {
            const f = e.target.files[0]; if (!f) return; const text = await f.text();
            try {
                const obj = JSON.parse(text);
                if (Array.isArray(obj.items)) items = obj.items; if (Array.isArray(obj.categories)) categories = obj.categories;
                save(KEY_ITEMS, items); save(KEY_CATS, categories); fillCategoryOptions(); render(); alert('ƒê√£ import th√†nh c√¥ng!');
            } catch { alert('File JSON kh√¥ng h·ª£p l·ªá'); }
            e.target.value = '';
        });

        // ===== Render =====
        $('search').addEventListener('input', render);
        $('filterCat').addEventListener('change', render);

        function render() {
            // KPIs
            const now = Date.now();
            const open = items.filter(x => !x.done).length;
            const soon = items.filter(x => !x.done && (new Date(x.due).getTime() - now) <= 24 * 3600000 && (new Date(x.due).getTime() - now) > 0).length;
            const over = items.filter(x => !x.done && (new Date(x.due).getTime() - now) < 0).length;
            $('kOpen').textContent = open; $('kSoon').textContent = soon; $('kOver').textContent = over;

            const q = $('search').value.toLowerCase();
            const fc = $('filterCat').value;
            const box = $('items'); box.innerHTML = '';
            let view = [...items];
            view = view.filter(x => (fc ? x.category === fc : true) && (q ? (x.title.toLowerCase().includes(q) || (x.note || '').toLowerCase().includes(q)) : true));

            if (view.length === 0) { box.innerHTML = '<div class="muted">Ch∆∞a c√≥ nh·∫Øc nh·ªü ph√π h·ª£p.</div>'; return }

            // sort: overdue first, then soonest
            view.sort((a, b) => new Date(a.due) - new Date(b.due));

            for (const it of view) {
                const ms = msLeft(it.due);
                const cls = it.done ? 'good' : ms < 0 ? 'bad' : (ms <= 24 * 3600000 ? 'warn' : '');
                const div = document.createElement('div'); div.className = 'item'; div.dataset.id = it.id;
                div.innerHTML = `
      <div class="meta"><span class="pill">${it.category}</span><span>${fmtDate(it.due)}</span></div>
      <div class="title">${escapeHTML(it.title)}</div>
      <div class="muted" style="margin:6px 0">${escapeHTML(it.note || '')}</div>
      <div class="countdown ${cls}">${it.done ? 'ƒê√£ ho√†n th√†nh' : humanLeft(ms)}</div>
      <div class="toolbar" style="margin-top:8px">
        <button class="btn ghost" data-act="toggle">${it.done ? '‚Ü©Ô∏è ƒê√°nh d·∫•u l·∫°i' : '‚úÖ Ho√†n th√†nh'}</button>
        <button class="btn ghost" data-act="del">üóëÔ∏è X√≥a</button>
      </div>`;
                box.appendChild(div);
            }
        }

        function escapeHTML(str = '') { return str.replace(/[&<>\"]/g, (s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }[s]))) }

        $('items').addEventListener('click', (e) => {
            const btn = e.target.closest('button'); if (!btn) return; const card = e.target.closest('.item'); if (!card) return;
            const id = card.dataset.id; const act = btn.getAttribute('data-act');
            if (act === 'del') { if (confirm('X√≥a nh·∫Øc nh·ªü n√†y?')) delItem(id); }
            if (act === 'toggle') { toggleDone(id); }
        });

        // Live countdown update each 30s
        setInterval(() => { render() }, 30000);

        updateBackupReminder();
        render();
    </script>
</body>

</html>